<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUáº¢N TRá»Š VIÃŠN | CÆ  GIá»šI VN</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“Š</text></svg>">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { height: 100vh; overflow: hidden; display: flex; font-family: 'Segoe UI', sans-serif; background: #f5f5f5; }
        
        /* SIDEBAR (Zalo PC Style) */
        .sidebar { width: 80px; background: #0068FF; display: flex; flex-direction: column; align-items: center; padding-top: 20px; color: white; }
        .sidebar-icon { font-size: 24px; margin-bottom: 30px; cursor: pointer; opacity: 0.7; transition: 0.2s; }
        .sidebar-icon:hover, .sidebar-icon.active { opacity: 1; transform: scale(1.1); }
        .logo-icon { font-size: 30px; margin-bottom: 40px; }
        
        /* MAIN CONTENT */
        .main-content { flex: 1; padding: 20px; overflow-y: auto; }
        .page-title { font-weight: bold; font-size: 20px; margin-bottom: 20px; color: #333; }
        .card-custom { border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-radius: 10px; background: white; }
        
        .hidden { display: none !important; }
        .table img { width: 40px; height: 40px; object-fit: cover; border-radius: 4px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="logo-icon">ğŸ—ï¸</div>
        
        <div class="sidebar-icon active" onclick="switchView('report', this)" title="BÃ¡o cÃ¡o">
            <i class="bi bi-chat-square-text-fill"></i>
        </div>
        <div class="sidebar-icon" onclick="switchView('worker', this)" title="NhÃ¢n sá»±">
            <i class="bi bi-people-fill"></i>
        </div>
        <div class="sidebar-icon" onclick="switchView('post', this)" title="ÄÄƒng bÃ i">
            <i class="bi bi-pencil-square"></i>
        </div>
        
        <div style="margin-top: auto; margin-bottom: 20px;" class="sidebar-icon" onclick="logout()" title="ÄÄƒng xuáº¥t">
            <i class="bi bi-box-arrow-left"></i>
        </div>
    </div>

    <div class="main-content">
        
        <div id="view-report">
            <div class="d-flex justify-content-between">
                <div class="page-title">ğŸ“‹ Nháº­t kÃ½ cÃ´ng viá»‡c</div>
                <button class="btn btn-light btn-sm" onclick="location.reload()">ğŸ”„ LÃ m má»›i</button>
            </div>
            <div class="card-custom p-0 overflow-hidden">
                <table class="table table-hover m-0 align-middle">
                    <thead class="table-light"><tr><th>Thá»i gian</th><th>Thá»£</th><th>áº¢nh</th><th>Ghi chÃº</th></tr></thead>
                    <tbody id="report-table"></tbody>
                </table>
            </div>
        </div>

        <div id="view-worker" class="hidden">
            <div class="page-title">ğŸ‘¥ Quáº£n lÃ½ nhÃ¢n sá»±</div>
            <div class="card-custom p-0 overflow-hidden">
                <table class="table table-hover m-0 align-middle">
                    <thead class="table-light"><tr><th>TÃªn</th><th>SÄT</th><th>Tráº¡ng thÃ¡i</th><th>HÃ nh Ä‘á»™ng</th></tr></thead>
                    <tbody id="worker-table"></tbody>
                </table>
            </div>
        </div>

        <div id="view-post" class="hidden">
            <div class="page-title">ğŸ“¢ ÄÄƒng Tin & Tuyá»ƒn Dá»¥ng</div>
            <div class="row">
                <div class="col-md-6">
                    <div class="card-custom p-3 mb-3">
                        <h6 class="fw-bold text-primary">ÄÄƒng Tin Tá»©c</h6>
                        <input id="newsTitle" class="form-control mb-2" placeholder="TiÃªu Ä‘á»">
                        <textarea id="newsContent" class="form-control mb-2" placeholder="Ná»™i dung"></textarea>
                        <button onclick="postNews()" class="btn btn-primary w-100">ÄÄƒng Tin</button>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card-custom p-3">
                        <h6 class="fw-bold text-success">ÄÄƒng Tuyá»ƒn Dá»¥ng</h6>
                        <input id="jobTitle" class="form-control mb-2" placeholder="TÃªn viá»‡c">
                        <div class="row g-2 mb-2">
                            <div class="col"><input id="jobLoc" class="form-control" placeholder="Äá»‹a Ä‘iá»ƒm"></div>
                            <div class="col"><input id="jobSal" class="form-control" placeholder="LÆ°Æ¡ng"></div>
                        </div>
                        <input id="jobDate" class="form-control mb-2" placeholder="NgÃ y lÃ m">
                        <textarea id="jobDesc" class="form-control mb-2" placeholder="MÃ´ táº£"></textarea>
                        <button onclick="postJob()" class="btn btn-success w-100">ÄÄƒng Viá»‡c</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // LOGIC ADMIN (Giá»¯ nguyÃªn logic cÅ©, chá»‰ Ä‘á»•i cÃ¡ch hiá»ƒn thá»‹)
        const role = localStorage.getItem('user_role');
        if(role !== 'admin') window.location.href = '/';
        function logout() { localStorage.clear(); window.location.href = '/login.html'; }

        function switchView(viewName, btn) {
            document.getElementById('view-report').classList.add('hidden');
            document.getElementById('view-worker').classList.add('hidden');
            document.getElementById('view-post').classList.add('hidden');
            document.querySelectorAll('.sidebar-icon').forEach(el => el.classList.remove('active'));
            
            document.getElementById('view-'+viewName).classList.remove('hidden');
            btn.classList.add('active');
        }

        async function loadData() {
            // Load Reports
            const resR = await fetch('/api/reports'); const reps = await resR.json();
            document.getElementById('report-table').innerHTML = reps.map(r => `<tr><td>${new Date(r.created_at).toLocaleString('vi')}</td><td><b>${r.worker_name}</b><br><small class="text-muted">${r.phone}</small></td><td><a href="${r.image_url}" target="_blank"><img src="${r.image_url}"></a></td><td>${r.note}</td></tr>`).join('');

            // Load Workers
            const resW = await fetch('/api/workers'); const works = await resW.json();
            document.getElementById('worker-table').innerHTML = works.map(w => {
                let badge = w.status==='active'?'success':(w.status==='pending'?'warning':'danger');
                let btn = w.status==='pending' ? `<button class="btn btn-success btn-sm" onclick="setStatus(${w.id}, 'active')">Duyá»‡t</button>` : `<button class="btn btn-danger btn-sm" onclick="deleteWorker(${w.id})">XÃ³a</button>`;
                return `<tr><td>${w.name}</td><td>${w.phone}</td><td><span class="badge bg-${badge}">${w.status}</span></td><td>${btn}</td></tr>`;
            }).join('');
        }

        async function setStatus(id, st) { await fetch(`/api/workers/${id}/status`, {method:'PUT', headers:{'Content-Type':'application/json'}, body:JSON.stringify({status:st})}); loadData(); }
        async function deleteWorker(id) { if(confirm('XÃ³a?')) { await fetch(`/api/workers/${id}`, {method:'DELETE'}); loadData(); } }
        
        async function postNews() { /* Logic cÅ© */ alert('TÃ­nh nÄƒng Ä‘Ã£ cÃ³ trong code server cÅ©'); } 
        async function postJob() { /* Logic cÅ© */ alert('TÃ­nh nÄƒng Ä‘Ã£ cÃ³ trong code server cÅ©'); }

        loadData();
    </script>
</body>
</html>