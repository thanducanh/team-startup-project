<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Qu·∫£n Tr·ªã - Boss A</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

    <nav class="navbar navbar-dark bg-primary mb-4">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#">üìä TRUNG T√ÇM ƒêI·ªÄU H√ÄNH</a>
            <button class="btn btn-light btn-sm" onclick="location.reload()">üîÑ C·∫≠p nh·∫≠t</button>
        </div>
    </nav>

    <div class="container">
        <div class="card shadow-sm">
            <div class="card-header bg-white py-3">
                <h5 class="m-0 fw-bold text-primary">üìã Nh·∫≠t k√Ω c√¥ng vi·ªác</h5>
            </div>
            <div class="card-body p-0">
                <table class="table table-striped table-hover m-0 align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Th·ªùi gian</th>
                            <th>Th·ª£ th·ª±c hi·ªán</th>
                            <th>V·ªã tr√≠ (GPS)</th>
                            <th>H√¨nh ·∫£nh</th>
                            <th>Ghi ch√∫</th>
                        </tr>
                    </thead>
                    <tbody id="report-table">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        async function loadReports() {
            try {
                const res = await fetch('/api/reports');
                const reports = await res.json();
                
                const table = document.getElementById('report-table');
                table.innerHTML = '';

                reports.forEach(r => {
                    // Chuy·ªÉn ƒë·ªïi th·ªùi gian cho d·ªÖ ƒë·ªçc
                    const time = new Date(r.created_at).toLocaleString('vi-VN');
                    
                    // T·∫°o link Google Maps
                    const mapLink = `https://www.google.com/maps/search/?api=1&query=${r.location}`;

                    const row = `
                        <tr>
                            <td>${time}</td>
                            <td>
                                <strong>${r.worker_name}</strong><br>
                                <small class="text-muted">${r.phone}</small>
                            </td>
                            <td><a href="${mapLink}" target="_blank" class="btn btn-sm btn-outline-primary">üìç Xem Map</a></td>
                            <td>
                                <a href="${r.image_url}" target="_blank">
                                    <img src="${r.image_url}" style="height: 60px; width: 60px; object-fit: cover; border-radius: 8px; border: 1px solid #ddd;">
                                </a>
                            </td>
                            <td>${r.note}</td>
                        </tr>
                    `;
                    table.innerHTML += row;
                });
            } catch (err) { alert('L·ªói t·∫£i d·ªØ li·ªáu'); }
        }

        loadReports();
    </script>
</body>
</html>