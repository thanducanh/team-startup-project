<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TRUNG TÃ‚M ÄIá»€U HÃ€NH | CÆ¡ Giá»›i VN</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“Š</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-primary mb-4">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#">ğŸ—ï¸ CÆ  GIá»šI VIá»†T NAM</a>
            <button class="btn btn-outline-light btn-sm" onclick="localStorage.clear();location.href='/login.html'">ÄÄƒng xuáº¥t</button>
        </div>
    </nav>

    <div class="container">
        <ul class="nav nav-pills mb-3" id="pills-tab">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#rp">ğŸ“‹ BÃ¡o cÃ¡o</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#hr">ğŸ‘¥ NhÃ¢n sá»±</button></li>
        </ul>

        <div class="tab-content">
            <div class="tab-pane fade show active" id="rp">
                <div class="card shadow-sm"><div class="card-body p-0"><table class="table table-striped m-0"><tbody id="report-table"></tbody></table></div></div>
            </div>
            <div class="tab-pane fade" id="hr">
                <div class="card shadow-sm"><div class="card-body p-0"><table class="table table-bordered m-0"><thead class="bg-secondary text-white"><tr><th>TÃªn</th><th>SÄT</th><th>Tráº¡ng thÃ¡i</th><th>Xá»­ lÃ½</th></tr></thead><tbody id="worker-table"></tbody></table></div></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const role = localStorage.getItem('user_role');
        if(role !== 'admin') window.location.href = '/';

        async function loadData() {
            // Load Reports
            const resR = await fetch('/api/reports');
            const reps = await resR.json();
            document.getElementById('report-table').innerHTML = reps.map(r => `<tr><td>${new Date(r.created_at).toLocaleString('vi')}</td><td><b>${r.worker_name}</b></td><td><a href="${r.image_url}" target="_blank">áº¢nh</a></td><td>${r.note}</td></tr>`).join('');

            // Load Workers
            const resW = await fetch('/api/workers');
            const works = await resW.json();
            document.getElementById('worker-table').innerHTML = works.map(w => {
                let btn = w.status === 'pending' ? `<button class="btn btn-success btn-sm" onclick="setStatus(${w.id}, 'active')">Duyá»‡t</button>` : `<button class="btn btn-danger btn-sm" onclick="setStatus(${w.id}, 'blocked')">KhÃ³a</button>`;
                if(w.status === 'blocked') btn = `<button class="btn btn-secondary btn-sm" onclick="setStatus(${w.id}, 'active')">Má»Ÿ</button>`;
                return `<tr><td>${w.name}</td><td>${w.phone}</td><td>${w.status}</td><td>${btn}</td></tr>`;
            }).join('');
        }

        async function setStatus(id, st) {
            await fetch(`/api/workers/${id}/status`, { method: 'PUT', headers: {'Content-Type':'application/json'}, body: JSON.stringify({status: st}) });
            loadData();
        }
        loadData();
    </script>
</body>
</html>